---
title: '“依赖注入”学习笔记      '
id: 11
categories:
  - Phalcon
date: 2013-02-02 10:14:56
tags: PHP
---

<span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">在</span><span lang="EN-US"><span style="font-family: Times New Roman;">Phalcon</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">使用手册中有谈到&ldquo;使用依赖注入&rdquo;，依赖注入的概念，对于学过</span><span lang="EN-US"><span style="font-family: Times New Roman;">JAVA</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">的人来说，应该比较熟悉。依赖注入（</span><span style="font-size: 10pt;" lang="EN-US"><span style="font-family: Times New Roman;">Dependency Injection</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，简称</span><span lang="EN-US"><span style="font-family: Times New Roman;">DI</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">），早期被称作控制反转（</span><span style="font-size: 10pt;" lang="EN-US"><span style="font-family: Times New Roman;">Inversion of control</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，简称</span><span lang="EN-US"><span style="font-family: Times New Roman;">IOC</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">）。</span>

<span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">首先了解一下</span><span lang="EN-US"><span style="font-family: Times New Roman;">OO</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">编程中的依赖关系：只要</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">类型中用到了</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">类型实例，</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">就依赖于</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">。而&ldquo;依赖注入&rdquo;这种设计模式则能消除</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">与</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">之间的直接依赖关系。其实，依赖注入就是用来削减程序的耦合问题的，也就是解除强依赖，它被称为目前最优秀的解耦方式。</span>

<span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">不过，解除强依赖，并非是</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">与</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">之间的依赖关系不复存在了，而实际上</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">总是还需要</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">提供的服务，因此只是把这种依赖的建立时间推后了，从编译器推迟到运行时了。换言之，即是在运行的时候才产生</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">和</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">之间的依赖关系，把这种依赖关系在一个合适的时机&ldquo;注入&rdquo;运行时。</span>

<span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">此外，</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">与</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">之间的关系，亦可抽象至&ldquo;服务使用者&rdquo;和&ldquo;服务提供者&rdquo;的角度，体现目前</span><span lang="EN-US"><span style="font-family: Times New Roman;">SOA</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">（</span><span style="font-family: Arial; color: black; font-size: 10pt;" lang="EN-US">service-oriented architecture</span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">）的设计思路。另外来看，也可把</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">看作是需要构建的主系统，而</span><span lang="EN-US"><span style="font-family: Times New Roman;">B</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">则是</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">系统中的</span><span lang="EN-US"><span style="font-family: Times New Roman;">Plugin</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，主系统</span><span lang="EN-US"><span style="font-family: Times New Roman;">A</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">并不强依赖与任何一个</span><span lang="EN-US"><span style="font-family: Times New Roman;">Plugin</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">，但一旦</span><span lang="EN-US"><span style="font-family: Times New Roman;">Plugin</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">被加载，主系统便调用适当</span><span lang="EN-US"><span style="font-family: Times New Roman;">Plugin</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">的功能。</span>

<span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-bidi-font-size: 10.5pt;">在<span lang="EN-US">Phalcon</span>中，它的依赖注入容器也是一个非常重要的概念。一个服务容器就相当于一个袋子，用于存储我们将要用到的一些服务，每当框架需要一个组件，将要求服务容器首先注册这个服务组件。<span lang="EN-US">Phalcon</span>是一个高度松耦合的框架，<span lang="EN-US">Phalcon\DI </span>将使这些要用到的服务组件透明的结合在一起。<span lang="EN-US">Phalcon\DI </span>是一个实现了服务的依赖注入功能的组件，它本身也是一个容器。容器作为全局注册表，使用容器的依赖注入做为一种桥梁来解决依赖可以使我们的代码耦合度更低，很好的降低了组件的复杂性。</span>
